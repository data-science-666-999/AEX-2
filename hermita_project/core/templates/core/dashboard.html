{% extends "core/base.html" %}

{% block title %}Dashboard - Hermita{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mt-4">Welcome to your Hermita Dashboard, {{ user.username }}!</h1>

    {% if user_groups %}
        <p class="lead">Your role(s): {{ user_groups|join:", " }}</p>
    {% else %}
        <p class="lead">You currently don't have a specific role assigned.</p>
    {% endif %}

    <hr>

    {% if "Landlord" in user_groups %}
        <div class="mt-4 mb-4">
            <h3>Landlord Dashboard</h3>
            <p><a href="{% url 'core:property_create' %}" class="btn btn-success">Add New Property</a></p>

            <h4 class="mt-4">My Listed Properties:</h4>
            {% if properties %}
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {% for property in properties %}
                        <div class="col">
                            <div class="card h-100">
                                {% if property.main_image %}
                                    <img src="{{ MEDIA_URL }}{{ property.main_image.url }}" class="card-img-top" alt="{{ property.title }}" style="max-height: 200px; object-fit: cover;">
                                {% else %}
                                    <img src="https://via.placeholder.com/300x200.png?text=No+Image" class="card-img-top" alt="No image available" style="max-height: 200px; object-fit: cover;">
                                {% endif %}
                                <div class="card-body">
                                    <h5 class="card-title">{{ property.title }}</h5>
                                    <p class="card-text">
                                        <strong>Address:</strong> {{ property.address_line1 }}, {{ property.city }}<br>
                                        <strong>Rent:</strong> KES {{ property.rent_amount|floatformat:2 }}<br>
                                        <strong>Status:</strong> {% if property.is_available %}Available{% else %}Not Available{% endif %}
                                    </p>
                                    {# Add links to edit/delete/view details later #}
                                    {# <a href="#" class="btn btn-sm btn-primary">View Details</a> #}
                                    {# <a href="#" class="btn btn-sm btn-warning">Edit</a> #}
                                    {# <a href="#" class="btn btn-sm btn-danger">Delete</a> #}
                                </div>
                                <div class="card-footer">
                                    <small class="text-muted">Posted: {{ property.date_posted|date:"d M Y" }}</small>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>You have not listed any properties yet.</p>
            {% endif %}
        </div>
    {% endif %}

    {% if "Tenant" in user_groups %}
        <div class="mt-3">
            <h3>Tenant Actions:</h3>
            <p><a href="#" class="btn btn-info">Browse Available Properties</a> (Placeholder)</p>
            <p><a href="#" class="btn btn-warning">View My Lease Agreements</a> (Placeholder)</p>
        </div>
    {% endif %}

    {% if not "Landlord" in user_groups and not "Tenant" in user_groups %}
        <p class="mt-5">More features coming soon!</p>
    {% endif %}
</div>
{% endblock %}
